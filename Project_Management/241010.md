## 🔹 백엔드 개발 플로우

> 자바, 스프링을 통해 개발을 진행하는 경우를 정리했다.

- 요구사항 분석 및 설계

  요구사항을 분석하여 시스템이 어떤 기능을 제공하는지 파악한다. 이를 바탕으로 **시스템 아키텍처**를 설계한다. **시스템 아키텍처는 DB 설계, API 설계, 클래스 및 객체 설계** 등이 있다.

- 프로젝트 세팅

  자바로 개발할 경우, 스프링 부트를 사용해서 프로젝트를 생성한다. 또한 필요한 라이브러리 의존성을 `maven` 또는 `gradle`로 추가한다.

- 도메인 모델 설계

  DB 테이블에 대응하는 **entity 클래스를 설계**하고 필요한 필드와 관계를 정의한다(erd 작성, 엔티티 클래스 생성). 데이터 전송 시 필요한 객체를 설계하여 불필요한 데이터를 숨기고 필요한 데이터만 전달한다(**dto 작성**) -> 데이터를 객체로 전환하는 것.

- JPA 레포지토리 생성 및 개발

  엔티티와 DB 간의 CRUD 작업을 처리하기 위해 `JpaRepository` 인터페이스를 상속받아 필요한 쿼리 메서드를 정의한다.

- 비즈니스 로직 구현

  실제 서비스 기능을 처리하는 비즈니스 로직을 `Service` 클래스에 작성한다. 일반적으로 `@Servcie` 어노테이션으로 주입되어 트랜잭션 관리 및 다양한 처리를 담당한다.

- 컨트롤러 개발

  **REST API 개발**을 진행한다. 클라이언트와 통신할 수 있도록 `@RestController`를 사용해 엔드포인트를 정의한다. 이곳에서 HTTP 요청을 받아 서비스 로직을 호출하고 결과를 반환한다.

  각 메서드에는 HTTP 메서드에 맞는 API를 설계한다. 이때 RequestMapping을 사용한다. `@GetMapping`, `@PostMapping`...

- 예외처리 및 검증

  `@ControllerAdvice`와 `@ExpectionHandler`를 이용해 전역적으로 예외를 처리하거나 개별적으로 예외를 처리한다.

  입력값 검증은 `@Valid`, `@NotNull`, `@Pattern` 등의 어노테이션을 사용해 클라이언트가 보낸 데이터를 검증한다.

- 보안 적용

  spring을 사용할 때는 **Spring Security를 적용**해서 jwt를 사용한 인증을 구현하거나 oauth를 사용할 수 있다.

- 테스트 진행

  **단위 테스트**(`JUnit`, `Mockito` 등을 사용해 각 모듈의 단위 테스트 작성), **통합 테스트**(전체 시스템이 통합되었을 때 `@SpringBootTest` 어노테이션을 사용해 통합 테스트 수행)를 진행한다.

- 배포

  `Maven` 또는 `Gradle`을 통해 **프로젝트를 빌드**한다. 이후 `Docker`, `Kubernetes`, 또는 **CI/CD 파이프라인을 이용해 배포를 자동화**할 수 있다. 스프링부트는 내장 톰캣 서버를 사용하기 때문에 별도의 서버 설정 없이 실행 가능하지만, 필요에 따라 외부 톰캣 서버에 배포할 수도 있다.

  **서버를 클라우드(aws, gcp, azure) 또는 도커 컨테이너로 설정**하여 배포 환경을 준비한다. 서버 설정이 완료되면 서버에 배포를 진행한다. AWS의 `EC2`, `Elastic Beanstalk`, `Heroku`, `DigitalOcean`과 같은 플랫폼에 배포한다.

  컨테이너 기반의 배포는 `Docker` 및 `Kubernetes`를 활용해 확장성과 관리성을 높인다.

  CI/CD 파이프라인 구축

- 유지보수

  - 로그관리: `Logback` 또는 `SLF4J` 같은 로깅 프레임워크를 사용해 시스템 동작을 추적하고 로그를 모니터링한다.

  - 모니터링 도구: `Prometheus`, `Grafana` 같은 모니터링 도구를 사용해 시스템 성능을 확인하고 장애를 대비한다.

  이 과정에서 CI/CD 도구(GitLab CI, Jenkins 등)와 협업 도구(JIRA, Confluence 등)를 통해 개발을 진행하며 지속적인 통합과 배포를 관리하는 것이 일반적이다.

---

### 💡 도메인 모델 설계

- 엔티티 클래스 생성

- DTO(Data Transfer Object)

---

### 💡 JPA

---

### 💡 Spring Security

---

### 💡 단위 테스트 도구

- JUnit

- Mockito

---

### 💡 Gradle

빌드도구

---

### 💡 배포 자동화

배포 자동화란 CI/CD 도구를 사용해서 코드 변경 시 자동으로 테스트, 빌드, 배포가 이루어지도록 하는 것이다.<br>
수동적이고 반복적인 배포 과정을 자동화함으로써 시간이 절약된다. 또한 사람이 만드는 에러를 방지할 수 있다. 배포 자동화를 통해 전체 배포 과정을 매번 일관되게 진행하는 구조를 설계하여 에러 발생 가능성을 낮출 수 있다.

- CI/CD 파이프라인

  배포 과정을 자동화시키는 방법을 CI/CD 파이프라인이라고 한다.

  <img src="https://velog.velcdn.com/images/edith_0318/post/512cd723-9e8b-441a-8bc2-018d708ae0d2/image.png" alt="cicd 파이프라인 이미지" width='500px'>

  개발자가 코드를 원격 저장소에 올리면, 그 코드가 빌드 및 테스트, 릴리즈를 거쳐 배포 서버로 전달된다. 배포 서버에 도달한 빌드 코드는 애플리케이션 서버로 최종 배포가 완료되고 결과물을 유저가 직접 확인할 수 있다.

  파이프라인은 전체 배포 과정을 여러 단계로 분리한다. 대표적으로 source 단계, build 단계, deploy단계가 있다.

  source 단계는 원격 저장소에 관리되고 있는 소스 코드에 대한 변경사항이 일어날 경우, 이를 감지하고 다음 단계로 전달한다.<br>
  build 단계는 이전 단계에서 전달받은 코드를 컴파일, 빌드, 테스트하여 가공한다. 또한 build 단계를 거쳐 생산된 결과물을 다음 단계로 전달하는 작업을 수행한다.<br>
  deploy 단계에서는 빌드된 결과물을 실제 서비스에 반영하는 작업을 수행한다.

  일반적으로 CI/CD 파이프라인 구성요소는 빌드, 테스트, 릴리즈, 배포, 규정 준수 및 유효성 검사로 이뤄져있으며 이 과정이 반복적인 프로세스로 진행되면서 일련의 자동화 단계로 만든다.

  - Jenkins 파이프라인 구축

    <img src="https://velog.velcdn.com/images/dlfrlwkd/post/518f5520-676c-44fa-be7f-130b32c0296b/image.jpeg" alt='젠킨스 데이터 흐름 이미지' width='500px'>

    젠킨스로 파이프라인을 구축할 때 기본 데이터 흐름은 로컬에서 작업 후 깃허브로 푸시하면 main 브랜치에 머지된 후 git에서 webhook이 발생한다.<br>
    젠킨스에서는 webhook이 발생된 걸 감지하고 빌드를 시작한다. 빌드 성공 시 jar 파일이 생성된다.<br>
    젠킨스 서버에서 ssh를 통해 원격 서버로 jar 파일을 전송한다. 원격 서버에 저장된 배포스크립트(deploy.sh)가 실행된다. 배포스크립트 내용에 따라 현재 실행 중인 스프링부트가 있으면 종료시키고 새로운 jar 파일을 실행시킨다.

    - CI 구축

    - CD 구축

    > 참고사이트) https://velog.io/@dlfrlwkd/Jenkins-CICD-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0

- Docker

  도커 컨테이너

---

### 💡 서버 배포

- AWS EC2

  EC2란 AWS에서 제공하는 클라우드 컴퓨팅 서비스로, 아마존이 사용자들에게 독립된 컴퓨터를 임대해주는 서비스이다.<br>
  EC2를 사용해 가상 서버를 구축하고, 보안 및 네트워크를 구성해서 빠르게 애플리케이션을 개발하고 배포할 수 있다. 인스턴스 유형, 운영체제, 소프트웨어 패키지 등을 선택할 수 있으며, 메모리, cpu, 부팅 파티션 크기 등을 선택할 수 있는 유연한 클라우드 호스팅 서비스이다.

  EC2 인스턴스란 가상 컴퓨팅 환경으로 웹 호스팅, 애플리케이션, 데이터베이스, 인증 서비스를 비롯해 서버가 수행하는 모든 워크로드를 지원한다.

  AMI(Amazon Machine Image)란 인스턴스를 시작하는데 필요한 정보를 제공하는 이미지로, 한 ami로 여러 인스턴스를 생성할 수 있다.<br>
  인스턴스를 생성하면 필요한 성능과 크기에 따라 적절한 유형을 선택해야 한다. 범용, 컴퓨팅 최적화, 메모리 최적화, 엑셀러레이티드 컴퓨팅, 스토리지 최적화가 있다.<br>
  보안그룹도 구성해야 하는데 보안그룹은 EC2 인스턴스에 허용되는 인바운드, 아웃바운드 트래픽을 제거하는 가상 방화벽이다. 기본 보안그룹은 모든 트래픽을 허용하며, 상태기반 규칙을 사용한다.<br>
  인스턴스에 안전하게 연결하기 위해서 키페어를 생성한다. 이때 다운로드되는 프라이빗 키 파일은 다시 받을 수 없기 때문에 꼭 안전하게 보관된 위치에 저장해두어야 한다.

  인스턴스가 성공적으로 생성되면 탄력적 IP를 할당한다. 인스턴스를 생성할 때는 항상 새 ip를 할당한다. 그래서 인스턴스를 중지하고 재시작하면 새로운 ip가 할당되기 때문에 고정적인 ip를 가질 수 있도록 탄력적 ip 주소를 할당해주는 것이 좋다.<br>
  ❗탄력적 ip를 만들과 ec2에 연결해주지 않으면 과금이 된다. 만들 때는 과금이 되지않지만 **연결을 안하면 과금**된다.

  마지막으로 ssh에 접속하여 인스턴스에 연결한다.

  > 참고사이트) https://velog.io/@kyj311/AWS-EC2-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0,<br> https://inpa.tistory.com/entry/AWS-%F0%9F%93%9A-EC2-%EA%B0%9C%EB%85%90-%EC%82%AC%EC%9A%A9-%EA%B5%AC%EC%B6%95-%EC%84%B8%ED%8C%85-%F0%9F%92%AF-%EC%A0%95%EB%A6%AC-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-EBS-AMI

- 컨테이너 기반 배포

---

### 💡 모니터링 도구

- Prometheus

- Grafana

---

### 💡 로깅 프레임워크

---
